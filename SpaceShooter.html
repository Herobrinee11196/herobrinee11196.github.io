<!DOCTYPE html>
<html>
<head>
  <title>Space Shooter</title>
  <style>
    body {
      background-color: black;
      margin: 0;
      overflow: hidden;
      color: white;
      font-family: monospace;
      user-select: none;
    }
    canvas {
      display: block;
      margin: auto;
      background-color: #111;
    }
    #fullscreen-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #222;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 5px;
      z-index: 1000;
      user-select: none;
    }
    #fullscreen-btn:hover {
      background: #555;
    }
    #back-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #222;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 5px;
      z-index: 1000;
      user-select: none;
    }
    #back-btn:hover {
      background: #555;
    }
  </style>
</head>
<body>

  <button id="back-btn">Back</button>
  <canvas id="game" width="800" height="600"></canvas>
  <button id="fullscreen-btn">Fullscreen</button>
  <button id="restart-btn">Restart</button>

  <script>
    window.onload = function () {
      const canvas = document.getElementById("game");
      const ctx = canvas.getContext("2d");
      const fullscreenBtn = document.getElementById("fullscreen-btn");
      const restartBtn = document.getElementById("restart-btn");

restartBtn.addEventListener("click", () => {
  // Reset game variables
  lives = 3;
  score = 0;
  totalKills = 0;
  superKillCounter = 0;
  canUseSuper = false;
  superBeamActive = false;
  superBeamTimer = 0;
  gameOver = false;
  bullets.length = 0;
  enemies.length = 0;
  player.x = canvas.width / 2 - player.width / 2;
});

      const backBtn = document.getElementById("back-btn");

      // Images load
      const playerStraight = new Image();
      playerStraight.src = "GoingStraight.png";

      const playerLeft = new Image();
      playerLeft.src = "MovingLeft.png";

      const playerRight = new Image();
      playerRight.src = "MovingRight.png";

      const enemyImg = new Image();
      enemyImg.src = "EnemyShip.png";

      const bulletImg = new Image();
      bulletImg.src = "bullet.png";

      const heartImg = new Image();
      heartImg.src = "heart.png";

      const player = {
        x: canvas.width / 2 - 25,
        y: canvas.height - 60,
        width: 50,
        height: 50,
        speed: 5,
        currentImage: playerStraight,
        get center() {
          return {
            x: this.x + this.width / 2,
            y: this.y + this.height / 2,
          };
        }
      };

      const bullets = [];
      const enemies = [];
      let keys = {};
      let totalKills = 0;              // total kills never reset
      let superKillCounter = 0;        // kills towards next super beam
      let canUseSuper = false;
      let superBeamActive = false;
      let superBeamTimer = 0;

      let lives = 3;
      let gameOver = false;

      let score = 0;

      let lastFireTime = 0;
      let fireCooldown = 200;  // default cooldown, can be 0 with cheat

      // Cheat states
      let cheatZeroCooldown = false;  // zbfc01
      let cheatInfiniteSuper = false; // isb02
      let cheatTenLives = false;      // tl03
      let cheatInvincible = false;    // ib04
      let cheatFullHeal = false;       // hpb05

      // Apply cheat codes here - just for demo, you can tie this to UI/input
      // For now, let's just hardcode them so you can see how they work
      // Replace or remove the following lines to test cheats as needed:
      // Example: activate all cheats for testing

      cheatZeroCooldown = true;  // zbfc01
      cheatInfiniteSuper = true; // isb02
      cheatTenLives = true;      // tl03
      cheatInvincible = true;    // ib04
      cheatFullHeal = true;      // hpb05

      // Set lives if cheatTenLives is active
      if (cheatTenLives) lives = 10;

      // Back button event
      backBtn.addEventListener("click", () => {
        window.location.href = "Games.html";
      });

      document.addEventListener("keydown", (e) => {
        keys[e.code] = true;

        if (e.code === "ArrowDown" && canUseSuper && !superBeamActive && !gameOver) {
          superBeamActive = true;
          superBeamTimer = 5000;

          if (!cheatInfiniteSuper) {
            canUseSuper = false;
            superKillCounter -= 30;
            if (superKillCounter < 0) superKillCounter = 0;
          }
        }
      });

      document.addEventListener("keyup", (e) => {
        keys[e.code] = false;
      });

      function spawnEnemy() {
        const size = 40;
        enemies.push({
          x: Math.random() * (canvas.width - size),
          y: -size,
          width: size,
          height: size,
          speed: 2
        });
      }

      function enemyDestroyed(isSuperKill = false) {
        totalKills++;
        superKillCounter++;
        if (superKillCounter >= 30) canUseSuper = true;

        if (isSuperKill) {
          score += 300;
        } else {
          score += 100;
        }
      }

      function checkCollision(a, b) {
        const padding = 5;
        return (
          a.x + padding < b.x + b.width - padding &&
          a.x + a.width - padding > b.x + padding &&
          a.y + padding < b.y + b.height - padding &&
          a.y + a.height > b.y + padding
        );
      }

      function checkPlayerEnemyCollision(player, enemy) {
        const c = player.center;
        const hitboxHeight = 4;
        return (
          c.x >= enemy.x &&
          c.x <= enemy.x + enemy.width &&
          c.y >= enemy.y + enemy.height - hitboxHeight &&
          c.y <= enemy.y + enemy.height
        );
      }

      function update(deltaTime) {
        if (gameOver) return;

        // Player movement & firing
        if (keys["ArrowLeft"]) {
          player.x -= player.speed;
          player.currentImage = playerLeft;
        } else if (keys["ArrowRight"]) {
          player.x += player.speed;
          player.currentImage = playerRight;
        } else {
          player.currentImage = playerStraight;
        }

        player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));

        if (keys["ArrowUp"]) {
          if (performance.now() - lastFireTime > fireCooldown) {
            bullets.push({
              x: player.x + player.width / 2 - 2,
              y: player.y,
              width: 4,
              height: 10,
              speed: 7
            });
            lastFireTime = performance.now();
          }
        }

        // Update bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
          bullets[i].y -= bullets[i].speed;
          if (bullets[i].y < 0) bullets.splice(i, 1);
        }

        // Update enemies & collisions
        for (let i = enemies.length - 1; i >= 0; i--) {
          enemies[i].y += enemies[i].speed;

          for (let j = bullets.length - 1; j >= 0; j--) {
            if (checkCollision(enemies[i], bullets[j])) {
              enemies.splice(i, 1);
              bullets.splice(j, 1);
              enemyDestroyed(false);
              break;
            }
          }

          if (i < enemies.length && checkPlayerEnemyCollision(player, enemies[i])) {
            enemies.splice(i, 1);

            if (!cheatInvincible) {
              lives--;
              if (lives <= 0) {
                gameOver = true;
              }
            }
          }

          if (i < enemies.length && enemies[i].y > canvas.height) {
            enemies.splice(i, 1);
          }
        }

        // Super Beam active
        if (superBeamActive) {
          superBeamTimer -= deltaTime;
          enemies.forEach((enemy, i) => {
            const beamWidth = 10;
            if (
              enemy.x + enemy.width >= player.x + player.width / 2 - beamWidth / 2 &&
              enemy.x <= player.x + player.width / 2 + beamWidth / 2
            ) {
              enemies.splice(i, 1);
              enemyDestroyed(true);
            }
          });

          if (superBeamTimer <= 0) {
            superBeamActive = false;
          }
        }

        // Spawn enemies randomly
        if (Math.random() < 0.02) {
          spawnEnemy();
        }

        // Apply cheat effects
        if (cheatZeroCooldown) {
          fireCooldown = 0;
        } else {
          fireCooldown = 200;
        }

        if (cheatTenLives) {
          lives = Math.min(lives, 10);  // Don't allow lives to go above 10 if cheat active
        }

        if (cheatFullHeal) {
          // Heal to max - lives is max lives for now
          // Since no health bar, we treat lives as health, so just set to max lives
          if (lives < (cheatTenLives ? 10 : 3)) {
            lives = cheatTenLives ? 10 : 3;
          }
        }
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw player
        ctx.drawImage(player.currentImage, player.x, player.y, player.width, player.height);

        // Draw bullets
        bullets.forEach((b) => {
          ctx.drawImage(bulletImg, b.x, b.y, b.width, b.height);
        });

        // Draw enemies
        enemies.forEach((e) => {
          ctx.drawImage(enemyImg, e.x, e.y, e.width, e.height);
        });

        // Draw lives (hearts)
        for (let i = 0; i < lives; i++) {
          ctx.drawImage(heartImg, 10 + i * 30, 10, 25, 25);
        }

        // Draw score
        ctx.fillStyle = "white";
        ctx.font = "20px monospace";
        ctx.fillText("Score: " + score, canvas.width - 150, 30);

        // Draw super beam info
        if (canUseSuper) {
          ctx.fillStyle = "aqua";
          ctx.font = "20px monospace";
          ctx.fillText("Super Beam Ready! (Press ↓)", canvas.width / 2 - 100, 30);
        }

        // If super beam active, draw beam
        if (superBeamActive) {
          ctx.fillStyle = "cyan";
          ctx.fillRect(player.x + player.width / 2 - 5, 0, 10, player.y);
          ctx.fillStyle = "white";
          ctx.font = "18px monospace";
          ctx.fillText("♾️ Super Beam Active ♾️", canvas.width / 2 - 90, player.y - 20);
        }

        // If game over
        if (gameOver) {
          ctx.fillStyle = "red";
          ctx.font = "50px monospace";
          ctx.fillText("Game Over!", canvas.width / 2 - 150, canvas.height / 2);
        }
      }

      let lastTime = performance.now();

      function gameLoop() {
        const now = performance.now();
        const deltaTime = now - lastTime;
        lastTime = now;

        update(deltaTime);
        draw();

        requestAnimationFrame(gameLoop);
      }

      gameLoop();

      // Fullscreen button
      fullscreenBtn.addEventListener("click", () => {
        if (!document.fullscreenElement) {
          canvas.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      });
    };
  </script>

</body>
</html>
